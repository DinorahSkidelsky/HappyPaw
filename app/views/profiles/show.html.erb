<div class="container">
  <div class="row">
    <div class="col-6">
    <%= cl_image_tag @profile.user.photo.key, class: "profile-photo rounded-circle", crop: :fill %>
    <h3 class="d-flex justify-content-start"><%= "#{@profile.user.first_name}" " #{@profile.user.last_name}" %></h3>
    <% @profile.photos.each do |photo| %>
      <%= cl_image_tag photo.key %>
    <% end %>
    <p><%= @profile.description %></p>
    <p><%= @profile.location %></p>
    <p>$<%= @profile.price %>/ Night</p>
    <p><%= @profile.phone_number %></p>
    </div>
  </div>

    <% if @profile.user_id != current_user.id %>
    <%= link_to 'Reserve Now', new_profile_reservation_path(@profile), class: "btn btn-warning moved-button" %>
    <% end %>
    <% if current_user.id == @profile.user_id %>
      <%= link_to '<i class= "fa fa-edit text-primary"></i>'.html_safe, edit_profile_path(@profile) %>
      <%= link_to '<i class= "fas fa-trash text-danger"></i>'.html_safe,
                        profile_path(@profile),
                        method: :delete,
                        data: { confirm: "Are you sure?" } %>
    <% end %>
    <strong>Reviews:</strong>

    <% @profile.reviews.each do |review|  %>
      <%= "⭐" * review.rating %>
      <%= review.content %>
    <% end %>

    <% if current_user.id != @profile.user_id %>
      <% if @chat %>
        <%= link_to "Continue Chatting", chatroom_path(@chat)%>
      <% else %>
        <%= link_to "Start Chat", chatrooms_path(user: current_user, profile: @profile), method: :post %>
      <% end %>
    <% end %>

    <div style="width: 50%; height: 50vh; position: sticky; top: 0; margin: 67px;"
         data-controller="mapbox"
         data-mapbox-markers-value="<%= @markers.to_json %>"
         data-mapbox-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
    </div>

    <%= link_to 'Back', profiles_path, class: "btn btn-dark" %>
</div>
